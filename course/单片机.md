# 单片机复习

### 第3章 单片机的结构和原理

#### 51单片机的基本组成

![image-20220607190521599](https://img.tim-wcx.ltd/i/2022/06/07/629f310419d0c.png)

​	XTAL1、XTAL2：晶振	

​	PSEN: 片外程序存储器读选通信号输出端, 低电平有效。 

​	EA：片外程序存储器读选通信号输出端, 低电平有效。 

​	RST：复位信号

​	ALE：地址锁存信号

​	RXD：串行数据接收

​	TXD：串行数据发送

​	INT0：外部中断0请求输入线

​	INT1：外部中断1请求输入线

​	T0：定时器/计数器0计数输入线

​	T1：定时器/计数器1计数输入线

​	WE：外部RAM写信号

​	RD：外部RAM读信号

​	P0：地址/数据总线，准双向IO

​	P1：准双向IO

​	P2：地址总线，准双向IO

​	P3：控制总线，准双向IO

![P0口结构](https://img.tim-wcx.ltd/i/2022/06/07/629f3b307d160.png)

![P1口结构](https://img.tim-wcx.ltd/i/2022/06/07/629f3b418eafb.png)

#### 51子系列单片机的存储器配置

1、8051存储器地址空间

  1. 片内、片外统一编址的程序存贮器ROM：64KB，地址：0000～0FFFFH；

     (低4KB，EA==0时外部ROM，否则内部ROM)

     MOVC指令访问

     PSEN片选读信号

  2. 片外数据存贮器RAM：64KB，地址：0000～0FFFFH；

     MOVX指令访问

     RD和WR信号

  3. 内部数据存贮器RAM：256B，地址：0~0FFH。

     MOV指令访问

2、ROM芯片

用途： 用于存放编好的程序和表格常数。

| 保留单元地址         | 入 口  地 址 | 用  途                                                   |
| ------------------------ | ---------------- | ------------------------------------------------------------ |
| 0000H～0002H | 0000H        | 复位后初始化引导程序                                     |
| 0003H～000AH | 0003H        | 外部中断0中断服务程序                            |
| 000BH～0012H | 000BH        | 定时/计数器0中断服务程序                 |
| 0013H～001AH | 0013H        | 外部中断1中断服务程序                            |
| 001BH～0022H | 001BH        | 定时/计数器1中断服务程序                 |
| 0023H～002AH | 0023H        | 串行口中断服务程序                                       |
| 002BH～0032H | 002BH        | 定时/计数器2中断服务程序(52子系列才有) |

3、RAM芯片

用途：用于存放运算的中间结果、数据暂存和缓冲、标志位等。

分类：片内RAM： 256字节；地址从0000～00FFH；片外RAM： 64K字节；地址从0000～FFFFH。

片内RAM：高128单元80H~0FFH SFR

​					低128单元00H~7FH 真正的RAM

![内部RAM](https://img.tim-wcx.ltd/i/2022/06/08/62a01f2d26aa5.png)

3.1 低128单元：

1）存储器区：四组寄存器，每组8个寄存单元（8位），各组都以R0、R1、R2、R3、R4、R5、R6、R7作寄存单元编号。寄存器常用于存放操作数及中间结果等，由于它们的功能及使用不作预先规定因此称之为通用寄存器，有时也叫工作寄存器、四组通用寄存器占据内部RAM的00H～1FH单元地址。

在任一时刻，CPU只能使用其中的一组寄存器，并且把正在使用的那组寄存器称之为当前寄存器组。到底是那一组由程序状态字寄存器PSW中RS0、RS1位的状态组合来决定。

R0～R7寄存器与内部RAM的地址对应

| 通用寄存器  名称 | 地  址        |                   |                   |         |
| ------------------------ | ----------------- | ----------------- | ----------------- | ------- |
| 第0组        | 第1组 | 第2组 | 第3组 |         |
| R0                   | 00H           | 08H           | 10H           | 18H |
| R1                   | 01H           | 09H           | 11H           | 19H |
| R2                   | 02H           | 0AH           | 12H           | 1AH |
| R3                   | 03H           | 0BH           | 13H           | 1BH |
| R4                   | 04H           | 0CH           | 14H           | 1CH |
| R5                   | 05H           | 0DH           | 15H           | 1DH |
| R6                   | 06H           | 0EH           | 16H           | 1EH |
| R7                   | 07H           | 0FH           | 17H           | 1FH |

2） 位寻址区：

地址：20H～2FH单元，共128位。

位地址：00H～7FH。

性质：既可作为一般RAM单元使用进行字节操作，也可以对单元中的每一位进行位操作，因此把该区称之为位寻址区。

3） 用户RAM区：

单元地址为30H～7FH，主要的数据缓冲区。

把堆栈开辟在此区。

3.2 高128单元：

特殊功能寄存器区、专用寄存器区 简称SFR。

单元地址：80H～FFH。

（1）累加器A或ACC（Accumulator）==0E0H==

8位寄存器，是最常用的专用寄存器

大部分单操作数指令的操作数就取自ACC，许多双操作数指令中的一个操作数也取自累加器。

（2） B寄存器 ==0F0H==

8位寄存器，主要用于乘除运算。如 MUL   AB

B寄存器也可作为一般数据寄存器使用。如MOV  B, #20H

（3） 数据指针（DPTR）16位寄存器

MCS-51中唯一的一个16位寄存器。

DPH：DPTR高位字节 ==83H==

DPL：DPTR低位字节 ==82H==

作用：通常在访问外部RAM时作地址指针使用, 由于外部数据存储器的寻址范围64KB。

DPTR既可按16位寄存器使用，也可以按两个8位寄存器分开使用。如： 

MOV   DPTR， #1234H  <==> MOV	DPH， #12H；MOV   DPL，  #34H

（4）程序计数器PC（Program Counter）

PC：16位的计数器。

其内容为将要执行的指令地址，寻址范围达64KB。  

有自动加 1功能，从而实现程序的顺序执行、 但PC没有地址，是不可寻址的、因此无法对它进行读写。但可以通过转移、调用、返回等指令改变其内容，以实现程序的转移。

（5）I/O端口P0～P3==（80H，90H，A0H，B0H）==

P0～P3为四个8位特殊功能寄存器，分别是四个并行I/O端口的锁存器。它们都有字节地址，每一个口锁存器还有位地址，所以当每一条I/O线独立地用作输入或输出时，数据可以锁存；作输入时，数据可以缓冲。

当I/O端口某一位用于输入信号时，对应的锁存器必须先置“1”。RST初始化为FFH

（6）程序状态字PSW（Program Status Word） ==0D0H==

8位寄存器，用于寄存程序运行的状态信息。

其中：有些位状态是根据程序执行结果，由硬件自动设置的而有些位状态则使用软件方法设定．

| D7                            | D6                                           | D5                                               | D4             |       D3       | D2                                                           | D1                              | D0                                                          |
| ----------------------------- | -------------------------------------------- | ------------------------------------------------ | -------------- | :------------: | ------------------------------------------------------------ | ------------------------------- | ----------------------------------------------------------- |
| CY                            | AC                                           | F0                                               | RS1            |      RS0       | OV                                                           | ...                             | P                                                           |
| 进位标志位                    | 辅助进位标志位                               | 用户标志位                                       | 寄存器组选择位 | 寄存器组选择位 | 溢出标志位                                                   | 外部中断0请求中断标志位         | 奇偶标志位                                                  |
| 有进位/借位，CY=1，否则，CY=0 | 低4位向高4位的进位或借位。有AC=1，否则AC=0。 | 需要时用软件方法置位或复位，用以控制程序的转向。 |                |                | 8位带符号数字加减运算结果是否超出运算范围。8位有符号数字表示的范围：－128～＋127。OV＝0，运算正确，即无溢出产生。在乘法运算中，OV＝1，表示乘积超过255；在除法运算中，OV＝1，表示除数为0，除法不能进行。 | IE1=1，INT0有中断产生(硬件控制) | 表明累加器A中1个个数的奇偶性，奇1偶0（串行输入输出的第9位） |

（7）PCON 电源控制  ==87H==

| D7   | D6      | D5             | D4    | D3  | D2  | D1 | D0  |
| -------- | ----------- | ------------------ | --------- | ------- | ------- | ------ | :-----: |
| SMOD | (SMOD0) | (LVDF) | (P0F) | GF1 | GF0 | PD | IDL |
| 与串口通信有关               | 单片机特有 | 单片机特有 | 单片机特有 | 通用工作标志位，用户可以自由使用。 | 通用工作标志位，用户可以自由使用。 | 掉电模式设定位。 |空闲模式设定位。|
| SMOD=0; 串口方式1，2，3时，波特率正常。SMOD=1; 串口方式1，2，3时，波特率加倍。 | \ | \ | \ | \ | \ | PD=0 单片机处于正常工作状态。PD=1 单片机进入掉电(Power Down)模式，可由外部中断或硬件复位模式唤醒，进入掉电模式后，外部晶振停振，CPU、定时器、串行口全部停止工作，只有外部中断工作。 |IDL=0 单片机处于正常工作状态。IDL=1 单片机进入空闲(Idle)模式，除CPU不工作外，其余仍继续工作，在空闲模式下可由任一个中断或硬件复位唤醒。|

（7）TCON 时钟控制  ==88H==

| D7                                | D6                  | D5                                | D4                  | D3                                | D2                            | D1                              |
| ---- | --------------------------------- | :-----------------: | --------------------------------- | ------------------- | --------------------------------- | ----------------------------- |
| TF1                               | TR1                 | TF0                               | TR0                 | IE1                               | IT1                           | IE0                             |
| T1溢出标志位                      | 定时计数器1控制位   | T0溢出标志位                      | 定时计数器0控制位   | 外部中断INT1请求中断标志位        | 外部中断INT1触发方式控制位    | 外部中断0请求中断标志位         |
| TF1=1表示T1有中断产生（硬件控制） | TR1=1表示T1开始运行 | TF0=1表示T0有中断产生（硬件控制） | TR0=1表示T0开始运行 | IE1=1，INT1有中断产生（硬件控制） | IT1=1时，INT1为跳变沿触发方式 | IE1=1，INT0有中断产生(硬件控制) |

（8）定时器TMOD  ==89H==

| 定时器1 |                                        |                                 |                                 | 定时器0 |                                        |                                 |                                 |
| ------- | -------------------------------------- | :-----------------------------: | ------------------------------- | ------- | -------------------------------------- | ------------------------------- | ------------------------------- |
| 7       | 6                                      |               *5*               | 4                               | 3       | 2                                      | 1                               | 0                               |
| GATE    | C/T                                    |               M1                | M0                              | GATE    | C/T                                    | M1                              | M0                              |
| 门控制  | C/T=0，定时器模式。C/T=1，计数器模式。 | 用来选择定时计/计数器的工作方式 | 用来选择定时计/计数器的工作方式 | 门控制  | C/T=0，定时器模式。C/T=1，计数器模式。 | 用来选择定时计/计数器的工作方式 | 用来选择定时计/计数器的工作方式 |

（9）总中断允许IE  ==0A8H==

| D7                | D6   | D5   | D4                   |           D3           | D2                       | D1                     | D0                       |
| ----------------- | ---- | ---- | -------------------- | :--------------------: | ------------------------ | ---------------------- | ------------------------ |
| EA                | -    | -    | ES                   |          ET1           | EX1                      | ET0                    | EX0                      |
| 总允许位          |      |      | 串行口中断允许位     | 定时器T1溢出中断允许位 | 外部中断1允许位          | 定时器T0溢出中断允许位 | 外部中断 INT0允许位      |
| EA=1，CPU开放中断 |      |      | ES=1，允许串行口中断 |   ET1=1，允许T1中断    | EX1=1，允许外部中断1中断 | ET0=1，允许T0中断      | EX0=1，允许外部中断0中断 |

（9）串行控制位SCON ==98H==

| D7             | D6             | D5                                     | D4               |                              D3                              | D2                                                           | D1                                                           | D0                                                           |
| -------------- | -------------- | -------------------------------------- | ---------------- | :----------------------------------------------------------: | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| SM0            | SM1            | SM2                                    | REN              |                             TB8                              | RB8                                                          | T1                                                           | R1                                                           |
| 工作方式选择位 | 工作方式选择位 | 多机通信控制位，主要用于方式2和方式3。 | 允许串行接收位。 | 在方式2或方式3中，是发送数据的第九位，可以用软件规定其作用。 | 在方式2或方式3中，是接收到数据的第九位，作为奇偶校验位或地址帧/数据帧的标志位。在方式1时，若SM2=0，则RB8是接收到的停止位。 | 串行口发送中断请求标志位                                     | 串行口接收中断请求标志位                                     |
|                |                |                                        |                  |                                                              |                                                              | 当发送完一帧串行数据后，由硬件置1，在转向中断服务程序后，用软件清0。 | 当接收完一帧串行数据后，由硬件置1；在转向中断服务程序后，用软件清0。 |

（10）定时器/计数器/串行数据

| 符号     | 地址 | 功能介绍                     |
| -------- | ---- | ---------------------------- |
| **TH1**  | 8DH  | 定时器/计数器1（高8位）      |
| **TH0**  | 8CH  | 定时器/计数器1（低8位）      |
| **TL1**  | 8BH  | 定时器/计数器0（高8位）      |
| **TL0**  | 8AH  | 定时器/计数器0（低8位）      |
| **SBUF** | 99H  | 串行口锁存器（两个，写和读） |

（11）中断优先级控制寄存器IP ==0B8H==

| D7   | D6   | D5   | D4                                   |                  D3                  | D2                                   | D1                                   | D0                                   |
| ---- | ---- | ---- | ------------------------------------ | :----------------------------------: | ------------------------------------ | ------------------------------------ | ------------------------------------ |
| /    | /    | /    | PS                                   |                 PT1                  | PX1                                  | PT0                                  | PX0                                  |
|      |      |      | 串行中断优先级设定位                 |        定时中断1优先级设定位         | 外部中断l优先级设定位                | 定时中断0优先级设定位                | 外部中断0优先级设定位                |
|      |      |      | X =0,  优先级为低；X=1, 优先级为高。 | X =0,  优先级为低；X=1, 优先级为高。 | X =0,  优先级为低；X=1, 优先级为高。 | X =0,  优先级为低；X=1, 优先级为高。 | X =0,  优先级为低；X=1, 优先级为高。 |

（12）堆栈指针SP ==81H==

堆栈：只允许在其一端进行数据插入和数据删除操作的线性表。RST初始化为07H。

（13）汇总

| **符号** | **地址** | **功能介绍**                |
| -------- | -------- | --------------------------- |
| **B**    | F0H      | B寄存器                     |
| **ACC**  | E0H      | 累加器                      |
| **PSW**  | D0H      | 程序状态字                  |
| **IP**   | B8H      | 中断优先级控制寄存器        |
| **P3**   | B0H      | P3口锁存器                  |
| **IE**   | A8H      | 中断允许控制寄存器          |
| **P2**   | A0H      | P2口锁存器                  |
| **SBUF** | 99H      | 串行口锁存器                |
| **SCON** | 98H      | 串行口控制寄存器            |
| **P1**   | 90H      | P1口锁存器                  |
| **TH1**  | 8DH      | 定时器/计数器1（高8位）     |
| **TH0**  | 8CH      | 定时器/计数器1（低8位）     |
| **TL1**  | 8BH      | 定时器/计数器0（高8位）     |
| **TL0**  | 8AH      | 定时器/计数器0（低8位）     |
| **TMOD** | 89H      | 定时器/计数器方式控制寄存器 |
| **TCON** | 88H      | 定时器/计数器控制寄存器     |
| **DPH**  | 83H      | 数据地址指针（高8位）       |
| **DPL**  | 82H      | 数据地址指针（低8位）       |
| **SP**   | 81H      | 堆栈指针                    |
| **P0**   | 80H      | P0口锁存器                  |
| **PCON** | 87H      | 电源控制寄存器              |
> 注：SFR可以位寻址的要求为地址以0或8结尾。